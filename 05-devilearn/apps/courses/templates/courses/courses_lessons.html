{% load static %}


    <div class="parents-container">
        <div class="card-wrapper">
            <div class="card">
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Optio, quibusdam animi. Exercitationem mollitia vero quasi eveniet dolor rerum totam in dignissimos id! Natus debitis repellat cumque, reprehenderit ipsa sapiente facilis exercitationem. Laboriosam, corporis illum nobis distinctio nesciunt nostrum optio quis suscipit doloremque aliquam ut error deserunt delectus similique reiciendis dolor ex fuga ducimus debitis omnis! Iste voluptatem commodi perferendis eum ullam vero, velit fuga dolores voluptates illo eveniet quia reiciendis, repudiandae quibusdam voluptas amet laudantium, earum fugit repellat cumque adipisci! Debitis suscipit quae dolor quia nobis sapiente pariatur. Fugiat unde nemo fuga error doloremque at illum ipsum adipisci hic dolorem.</p>
            </div>
            <div class="card">
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Optio, quibusdam animi. Exercitationem mollitia vero quasi eveniet dolor rerum totam in dignissimos id! Natus debitis repellat cumque, reprehenderit ipsa sapiente facilis exercitationem. Laboriosam, corporis illum nobis distinctio nesciunt nostrum optio quis suscipit doloremque aliquam ut error deserunt delectus similique reiciendis dolor ex fuga ducimus debitis omnis! Iste voluptatem commodi perferendis eum ullam vero, velit fuga dolores voluptates illo eveniet quia reiciendis, repudiandae quibusdam voluptas amet laudantium, earum fugit repellat cumque adipisci! Debitis suscipit quae dolor quia nobis sapiente pariatur. Fugiat unde nemo fuga error doloremque at illum ipsum adipisci hic dolorem.</p>
            </div>
            <div class="card">
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Optio, quibusdam animi. Exercitationem mollitia vero quasi eveniet dolor rerum totam in dignissimos id! Natus debitis repellat cumque, reprehenderit ipsa sapiente facilis exercitationem. Laboriosam, corporis illum nobis distinctio nesciunt nostrum optio quis suscipit doloremque aliquam ut error deserunt delectus similique reiciendis dolor ex fuga ducimus debitis omnis! Iste voluptatem commodi perferendis eum ullam vero, velit fuga dolores voluptates illo eveniet quia reiciendis, repudiandae quibusdam voluptas amet laudantium, earum fugit repellat cumque adipisci! Debitis suscipit quae dolor quia nobis sapiente pariatur. Fugiat unde nemo fuga error doloremque at illum ipsum adipisci hic dolorem.</p>
            </div>
            <div class="card">
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Optio, quibusdam animi. Exercitationem mollitia vero quasi eveniet dolor rerum totam in dignissimos id! Natus debitis repellat cumque, reprehenderit ipsa sapiente facilis exercitationem. Laboriosam, corporis illum nobis distinctio nesciunt nostrum optio quis suscipit doloremque aliquam ut error deserunt delectus similique reiciendis dolor ex fuga ducimus debitis omnis! Iste voluptatem commodi perferendis eum ullam vero, velit fuga dolores voluptates illo eveniet quia reiciendis, repudiandae quibusdam voluptas amet laudantium, earum fugit repellat cumque adipisci! Debitis suscipit quae dolor quia nobis sapiente pariatur. Fugiat unde nemo fuga error doloremque at illum ipsum adipisci hic dolorem.</p>
            </div>
        </div>
    </div>
    <!-- HEADER SUPERIOR -->
    <header class="topbar">
        <div class="acciones">
            <div class="back-link"> <button class="discusiones">← Ve al panel de control</button></div>
        </div>
        <div class="logo"><img src="{% static 'images/devilearn.png' %}" alt="Logo devilearn"></div>
    </header>

    <!-- LAYOUT PRINCIPAL -->
    <div class="layout">
        <!-- SIDEBAR IZQUIERDA -->
        <aside class="sidebar">


            <h1 class="course-title">{{ lesson.course_title }}</h1>
            <p class="progress">{{ lesson.course_progress }}% completado</p>


            <input class="lesson-search" placeholder="Buscar...">
            <option>Buscar por título de lección</option>
            </select>

            <!-- SECCIONES -->
            <div class="accordion">
                {% for content in lesson.course_content %}
                    <div class="accordion-item">
                        <button class="accordion-header">Sección {{ forloop.counter }}: {{ content.name }} <span>{{ content.complete_lessons }} / {{ content.total_lessons }}</span></button>
                        <div class="accordion-content">
                            <ul>
                                {% for lesson  in content.lessons %}
                                    <li>{{ lesson.name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </aside>

        <!-- CONTENIDO PRINCIPAL (VIDEO) -->
        <main class="main-content">
            <div class="content-header">Introducción al curso</div>
            <div class="video-wrapper">
                <video controls
                    poster="https://placehold.co/800x450?text=Este+curso+est%C3%A1+en+proceso+de+construcci%C3%B3n">
                    <source src="video-demo.mp4" type="video/mp4">
                    Tu navegador no soporta videos.
                </video>
            </div>
            <div class="bottom-bar">
                <button class="btn-complete">COMPLETAR Y CONTINUAR →</button>
            </div>
        </main>
    </div>

    <!-- CSS Codes -->

<!-- CSS CLASSES
parents-container
card-wrapper
card 
-->

<style>
    html, body{
    width: 100%;
    overflow-x: clip;
}

.parents-container{
    transition: none !important;
    
}

.card-wrapper{
    min-width: 1920px;
    will-change: transform;
    transition: none !important;
}

.card-wrapper .card{
    min-width: 400px !important; /*Destop Slide width adjustment*/
}

@media (max-width: 767px) {
	.card-wrapper .card{
	    min-width: 75vw !important; /*Mobile Slide width adjustment*/
	}
}
</style>


<!-- Javascript Codes -->

<link rel="stylesheet" href="https://unpkg.com/lenis@1.1.18/dist/lenis.css" />
<script src="https://unpkg.com/lenis@1.1.18/dist/lenis.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>

<script>
gsap.registerPlugin(ScrollTrigger);

let lenis;
function initLenisIfDesktop() {
  if (window.innerWidth > 1024 && !lenis && typeof Lenis !== "undefined") {
    lenis = new Lenis({ duration: 1.5 });

    function raf(time) {
      lenis.raf(time);
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);

    ScrollTrigger.scrollerProxy(document.documentElement, {
      scrollTop(value) {
        if (arguments.length) {
          lenis.scrollTo(value, { immediate: true });
        }
        return window.scrollY || window.pageYOffset;
      },
      getBoundingClientRect() {
        return {
          top: 0,
          left: 0,
          width: innerWidth,
          height: innerHeight
        };
      },
      fixedMarkers: true
    });

    lenis.on("scroll", ScrollTrigger.update);
  }
}

window.addEventListener("load", () => {
  initLenisIfDesktop();
});


if (window.matchMedia("(max-width: 1024px)").matches) {
  ScrollTrigger.normalizeScroll(true);
}

const mm = gsap.matchMedia();
const containerCards = document.querySelector(".parents-container");
const cards = document.querySelector(".card-wrapper");

let endLen = 0;
let finalX = 0;

function measure(respiroPx = 0) {
  const prev = cards.style.transform;
  cards.style.transform = "none";

  const contRect = containerCards.getBoundingClientRect();
  const lastRect = cards.lastElementChild.getBoundingClientRect();
  const padR = parseFloat(getComputedStyle(containerCards).paddingRight || 0);

  const overflowRight = lastRect.right - (contRect.right - padR);
  const need = Math.max(0, Math.ceil(overflowRight) + respiroPx);

  cards.style.transform = prev;

  endLen = need;
  finalX = -need;
}

let tl;
function build(respiroPx = 0) {
  ScrollTrigger.getAll().forEach((st) => {
    if (st.vars?.trigger === containerCards) st.kill();
  });

  gsap.set(cards, { x: 0, force3D: true, willChange: "transform" });

  measure(respiroPx);

  tl = gsap.timeline({
    scrollTrigger: {
      trigger: containerCards,
      start: "top top",
      end: () => "+=" + endLen,
      scrub: true,
      pin: true,
      pinType: window.matchMedia("(max-width: 767px)").matches
        ? "transform"
        : "fixed",
      anticipatePin: 1,
      fastScrollEnd: true,
      invalidateOnRefresh: true,
      onRefreshInit: () => gsap.set(cards, { x: 0 }),
      onRefresh: () => {
        measure(respiroPx);
        tl.scrollTrigger.end = tl.scrollTrigger.start + endLen;
      }
    }
  }).to(cards, { x: () => finalX, ease: "none", immediateRender: false });

  return tl;
}

/*adjust where the cards should scroll and stop here*/
mm.add("(max-width: 767px)", () => build(0)); //mobile
mm.add("(min-width: 768px) and (max-width: 1024px)", () => build(20)); //tablet
mm.add("(min-width: 1025px)", () => build(80)); //desktop

let rTO;
window.addEventListener("resize", () => {
  clearTimeout(rTO);
  rTO = setTimeout(() => {
    initLenisIfDesktop();
    ScrollTrigger.refresh();
  }, 120);
});
</script>
    